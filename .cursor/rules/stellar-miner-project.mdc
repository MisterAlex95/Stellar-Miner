---
description: Stellar Miner project context and conventions for AI
alwaysApply: true
---

# Stellar Miner — Project rules

- **Vibecoded for fun**: This is a hobby idle game. Prefer playful, maintainable code; avoid over-engineering. Scope is flexible.
- **Stack**: TypeScript (ES2022, strict), Vite, Vitest, Playwright. ESLint + Prettier. All code and comments in English.
- **Architecture**: DDD-style layers. **domain/** (entities, value objects, aggregates, events, services) → **application/** (gameState, handlers, catalogs, quests, research, eventBus, strings, etc.) → **presentation/** (views, toasts, canvases) → **infrastructure/** (SaveLoadService). Do not bypass layers (e.g. presentation must not call domain services directly; use application handlers).
- **Key entry points**: Game bootstrap in `src/game.ts`; UI mount in `src/presentation/mount.ts`; handlers in `src/application/handlers.ts`. State in `gameState.ts`; persistence in `SaveLoadService`; i18n via `t(key)` from `strings.ts`.
- **Docs**: See `docs/ARCHITECTURE.md` for DDD and flows; `docs/IDEAS.md` for backlog. Keep README and ARCHITECTURE in sync when adding features.
- **Tests**: Unit tests next to or in `*.test.ts`; E2E in `e2e/`. Run `yarn test`, `yarn test:coverage`, `yarn test:e2e`. Coverage is configured in `vite.config.ts` (provider: v8, reporters: text/html/lcov, thresholds, handlers and presentation excluded).
- **Typecheck**: After making code changes, always run `npm run typecheck` (or `yarn typecheck`) and fix any TypeScript errors before considering the task done.
- **Version & changelog**: When adding features or shipping user-facing changes, always (1) bump `version` in `package.json` (e.g. 0.1.0 → 0.2.0 or patch 0.1.1), and (2) add a new entry at the top of `src/data/changelog.json` with `version`, `date` (e.g. "2025-02"), and `changes` (array of short strings). Newest entry first. The app reads version from package.json at build time and shows the changelog in the "What's new" modal.
