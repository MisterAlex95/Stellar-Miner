/* Layout and shell: Tailwind @layer components (theme via @apply) */
@keyframes tab-badge-pulse {
  0%, 100% { opacity: 1; text-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
  50% { opacity: 0.85; text-shadow: 0 0 14px rgba(34, 197, 94, 0.6); }
}
@layer components {
  #app[data-active-tab="mine"] .stats {
    @apply static;
  }

  .app-tabs {
    @apply flex gap-1 mb-4 p-1 relative overflow-visible bg-card rounded-md border border-border;
  }

  .app-tabs-scroll {
    @apply flex gap-1 flex-1 min-w-0 overflow-x-auto overflow-y-hidden flex-nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }
  .app-tabs-scroll::-webkit-scrollbar {
    height: 4px;
  }
  .app-tabs-scroll::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
  }
  .app-tabs-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--text-dim);
  }

  .app-tab {
    @apply flex-1 min-w-0 inline-flex items-center justify-center gap-[0.35em] py-2 px-1.5 border-none rounded-sm cursor-pointer transition-colors duration-200 font-display text-sm font-semibold tracking-wide text-foreground-muted bg-transparent;
  }
  .app-tab:hover {
    @apply text-foreground bg-surface;
  }
  .app-tab--active {
    @apply bg-primary text-background;
  }
  .app-tab--active .app-tab-key {
    @apply text-background bg-white/25 border-white/40;
  }
  .app-tab:focus-visible {
    @apply outline-2 outline-primary outline-offset-2;
  }
  .app-tab > span:not(.app-tab-key) {
    @apply whitespace-nowrap overflow-hidden text-ellipsis;
  }

  #app[data-show-tab-labels="false"] .app-tab-label {
    @apply hidden;
  }

  .app-tab-key {
    @apply inline-flex items-center justify-center min-w-[1.25em] h-[1.25em] px-0.5 text-xs font-bold shrink-0 text-foreground-muted bg-black/25 border border-border rounded;
  }

  .app-tab--has-action:not(.app-tab--active) {
    @apply text-success;
    text-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
    animation: tab-badge-pulse 2s ease-in-out infinite;
  }
  .app-tab--has-action:not(.app-tab--active):hover {
    @apply text-success;
  }

  .app-tabs-more-wrap {
    @apply hidden shrink-0 relative overflow-visible;
  }
  .app-tabs-more-wrap--empty {
    @apply !hidden;
  }

  .app-tab-more {
    @apply min-w-10 text-lg leading-none py-2 px-2;
  }
  .app-tab-more--active,
  .app-tab-more--active:hover {
    @apply bg-primary text-background;
  }
  .app-tab-more--has-action.app-tab-more--active .app-tab-more-dots,
  .app-tab-more--has-action.app-tab-more--expanded .app-tab-more-dots {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
  }
  .app-tab-more--has-action:not(.app-tab-more--active):not(.app-tab-more--expanded),
  .app-tab-more--has-action:not(.app-tab-more--active):not(.app-tab-more--expanded):hover {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.35);
  }

  .app-tabs-menu {
    @apply absolute top-full right-0 mt-1 min-w-40 p-1.5 flex flex-col gap-0.5 bg-surface border border-border rounded-sm z-40 shadow-[0_8px_24px_rgba(0,0,0,0.35)];
  }
  .app-tabs-menu[hidden] {
    @apply !hidden;
  }

  .app-tabs-menu-item {
    @apply flex items-center gap-2 w-full text-left font-display text-sm font-semibold tracking-wide py-2 px-3 rounded border-none bg-transparent text-foreground-muted cursor-pointer transition-colors duration-200;
  }
  .app-tabs-menu-item:hover {
    @apply bg-card text-foreground;
  }
  .app-tabs-menu-item--active {
    background: rgba(245, 158, 11, 0.2);
    @apply text-primary border border-primary/40;
  }
  .app-tabs-menu-item--active:hover {
    background: rgba(245, 158, 11, 0.3);
    @apply text-primary;
  }
  .app-tabs-menu-item--has-action:not(.app-tabs-menu-item--active) {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.35);
  }
  .app-tabs-menu-item:focus-visible {
    @apply outline-2 outline-primary outline-offset-2;
  }

  .app-tabs-menu-item {
    @apply hidden;
  }

  .app-tabs-bottom {
    @apply hidden;
  }

  .app-tab-panel {
    @apply hidden;
  }
  .app-tab-panel--active {
    @apply block;
  }
  .app-tab-panel .quest-section,
  .app-tab-panel .dashboard-section,
  .app-tab-panel .prestige-section,
  .app-tab-panel .crew-section,
  .app-tab-panel .planets-section,
  .app-tab-panel .housing-section,
  .app-tab-panel .research-section,
  .app-tab-panel .upgrades-section,
  .app-tab-panel .statistics-section {
    @apply mb-6;
  }
  #app[data-layout="one-page"] .app-tab-panel {
    @apply block;
  }
  #app[data-layout="one-page"] .quest-section,
  #app[data-layout="one-page"] .dashboard-section,
  #app[data-layout="one-page"] .prestige-section,
  #app[data-layout="one-page"] .crew-section,
  #app[data-layout="one-page"] .planets-section,
  #app[data-layout="one-page"] .research-section,
  #app[data-layout="one-page"] .upgrades-section,
  #app[data-layout="one-page"] .statistics-section {
    @apply mb-7;
  }
  #app[data-layout="one-page"] .planets-section,
  #app[data-layout="one-page"] .prestige-section {
    @apply border-t border-border pt-4 mt-1;
  }
  .app-tab-panel .mine-zone {
    @apply mb-6;
  }
  #app[data-layout="tabs"] .gameplay-block-body {
    @apply max-h-none overflow-visible;
  }
  #app[data-layout="one-page"] .gameplay-block-body {
    @apply overflow-y-auto overflow-x-hidden;
    max-height: min(65vh, 520px);
    -webkit-overflow-scrolling: touch;
  }
}

/* Responsive: #app padding */
@media (max-width: 360px) {
  #app {
    padding: 0.5rem;
    padding-left: max(0.5rem, env(safe-area-inset-left));
    padding-right: max(0.5rem, env(safe-area-inset-right));
  }
}
@media (min-width: 361px) and (max-width: 767px) {
  #app {
    @apply p-4;
  }
}
@media (min-width: 768px) and (max-width: 1023px) {
  #app {
    @apply max-w-[720px] px-8 py-6;
  }
}
@media (min-width: 1024px) {
  #app {
    @apply max-w-[640px] p-8;
  }
}

/* Tabs overflow: show menu items when tab is hidden */
@media (max-width: 620px) {
  .app-tabs-menu-item[data-tab="stats"] {
    @apply block;
  }
  .app-tab[data-tab="stats"] {
    @apply !hidden;
  }
  .app-tabs-more-wrap {
    @apply !block;
  }
}
@media (max-width: 520px) {
  .app-tabs-menu-item[data-tab="upgrades"] {
    @apply block;
  }
  .app-tab[data-tab="upgrades"] {
    @apply !hidden;
  }
}
@media (max-width: 440px) {
  .app-tabs-menu-item[data-tab="research"] {
    @apply block;
  }
  .app-tab[data-tab="research"] {
    @apply !hidden;
  }
}
@media (max-width: 360px) {
  .app-tabs-menu-item[data-tab="empire"] {
    @apply block;
  }
  .app-tab[data-tab="empire"] {
    @apply !hidden;
  }
}
@media (max-width: 320px) {
  .app-tabs-menu-item[data-tab="dashboard"] {
    @apply block;
  }
  .app-tab[data-tab="dashboard"] {
    @apply !hidden;
  }
  .app-tab[data-tab="mine"] {
    @apply flex-1 min-w-0;
  }
}

/* Bottom nav @ 480px */
@media (max-width: 480px) {
  .app-tabs,
  #keyboard-hint,
  .keyboard-hint.keyboard-hint--below-tabs {
    @apply !hidden;
  }
  .app-tabs-bottom {
    @apply flex fixed bottom-0 left-0 right-0 z-50 p-2 gap-2 items-center bg-card border-t border-border shadow-[0_-4px_20px_rgba(0,0,0,0.2)];
    padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
  }
  .app-tab-bottom {
    @apply flex-1 min-h-12 font-display text-base font-semibold tracking-wide py-2.5 px-2.5 border-none rounded-sm cursor-pointer transition-colors duration-200 bg-surface text-foreground-muted;
  }
  .app-tab-bottom:hover {
    @apply bg-background text-foreground;
  }
  .app-tab-bottom--active {
    @apply bg-primary text-background;
  }
  .app-tab-bottom-more {
    @apply shrink-0 min-w-12;
  }
  .app-tab-bottom-more--active {
    @apply bg-primary text-background;
  }
  .app-tab-bottom-more--has-action.app-tab-bottom-more--active .app-tab-more-dots,
  .app-tab-bottom-more--has-action.app-tab-bottom-more--expanded .app-tab-more-dots {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
  }
  .app-tab-bottom-more--has-action:not(.app-tab-bottom-more--active):not(.app-tab-bottom-more--expanded),
  .app-tab-bottom-more--has-action:not(.app-tab-bottom-more--active):not(.app-tab-bottom-more--expanded):hover {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.35);
  }
  .app-tab-bottom--has-action:not(.app-tab-bottom--active) {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.35);
    animation: tab-badge-pulse 2s ease-in-out infinite;
  }
  .app-tab-bottom--has-action:not(.app-tab-bottom--active):hover {
    @apply text-success;
  }
  .app-tab-bottom:focus-visible {
    @apply outline-2 outline-primary outline-offset-2;
  }
  .app-tabs-bottom-more-wrap {
    @apply relative shrink-0;
  }
  .app-tabs-bottom-more-wrap--empty {
    @apply !hidden;
  }
  .app-tabs-bottom-menu {
    @apply absolute bottom-full right-0 mb-1 min-w-40 p-1.5 flex flex-col gap-0.5 bg-surface border border-border rounded-sm z-[51] shadow-[0_8px_24px_rgba(0,0,0,0.35)];
  }
  .app-tabs-bottom-menu[hidden] {
    @apply !hidden;
  }
  .app-tabs-bottom-menu-item {
    @apply flex items-center gap-2 w-full text-left font-display text-sm font-semibold tracking-wide py-2 px-3 rounded border-none bg-transparent text-foreground-muted cursor-pointer transition-colors duration-200;
  }
  .app-tabs-bottom-menu-item:hover {
    @apply bg-card text-foreground;
  }
  .app-tabs-bottom-menu-item--active {
    background: rgba(245, 158, 11, 0.2);
    @apply text-primary border border-primary/40;
  }
  .app-tabs-bottom-menu-item--has-action:not(.app-tabs-bottom-menu-item--active) {
    @apply text-success;
    text-shadow: 0 0 8px rgba(34, 197, 94, 0.35);
  }
  .app-tabs-bottom-menu-item--has-action:not(.app-tabs-bottom-menu-item--active):hover {
    @apply text-success bg-card;
  }
  .app-tabs-bottom-menu-item:focus-visible {
    @apply outline-2 outline-primary outline-offset-2;
  }
  #app {
    padding-bottom: calc(72px + env(safe-area-inset-bottom));
  }
}
